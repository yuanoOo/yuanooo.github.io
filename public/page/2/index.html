<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>破晓 - 日拱一卒，功不唐捐</title><meta name="keywords" content="个人博客、Code、学习、linux、大数据、java、flink"><meta name="author" content="破晓"><meta name="copyright" content="破晓"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="日拱一卒，功不唐捐">
<meta property="og:type" content="website">
<meta property="og:title" content="破晓">
<meta property="og:url" content="https://poxiao.tk/page/2/index.html">
<meta property="og:site_name" content="破晓">
<meta property="og:description" content="日拱一卒，功不唐捐">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://poxiao.tk/img/bg/avatar.webp">
<meta property="article:author" content="破晓">
<meta property="article:tag" content="个人博客、Code、学习、linux、大数据、java、flink">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://poxiao.tk/img/bg/avatar.webp"><link rel="shortcut icon" href="/img/bg/avatar.webp"><link rel="canonical" href="https://poxiao.tk/page/2/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="v7W8T1yBsImqvya-nz126O5wJTmGsQyUQJ_F8vmgUVU"/><meta name="baidu-site-verification" content="code-0Fs0BLUCMV"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-6838336925474374',
  enable_page_level_ads: 'true'
});</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-NDZBTJH9W4"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NDZBTJH9W4');
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 破晓","link":"链接: ","source":"来源: 破晓","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '破晓',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-06-27 22:21:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bg/avatar.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('/img/bg/banner.gif')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">破晓</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">破晓</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/Leopard" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:sssbbbb@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover right"><a href="/2023/03/bigdata/scala/scala%E8%AF%AD%E6%B3%95demo/" title="Scala特殊语法指南"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zfh-tuchuang.oss-cn-shanghai.aliyuncs.com/img/site-backgound.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Scala特殊语法指南"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/03/bigdata/scala/scala%E8%AF%AD%E6%B3%95demo/" title="Scala特殊语法指南">Scala特殊语法指南</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-03-08T11:54:07.000Z" title="发表于 2023-03-08 19:54:07">2023-03-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/bigdata/">bigdata</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/bigdata/scala/">scala</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/scala/">scala</a></span></div><div class="content">柯里化在Scala中，定义了两组空括号()()的方法称为“柯里化方法”。这意味着该方法采用多个参数列表，每个参数列表都由一组空括号表示。
例如，考虑以下方法定义：
1def add(a: Int)(b: Int): Int = a + b

在这种情况下，add是一个柯里化方法，它以单独的参数列表接受两个整数参数a和b。要调用此方法，您首先需要提供a的值，然后是b。这看起来像：
1val result = add(1)(2) // result是3

柯里化方法在函数式编程中非常有用，可以允许部分函数应用，函数组合和其他高阶编程技术。
123456789101112131415161718192021222324252627282930313233/** * Execute a block of code that evaluates to Unit, stop SparkContext if there is any uncaught * exception * * NOTE: This method is to be called by the driver-side compon ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/03/bigdata/spark/spark%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/" title="Spark事件总线源码分析"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zfh-tuchuang.oss-cn-shanghai.aliyuncs.com/img/site-backgound.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spark事件总线源码分析"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/03/bigdata/spark/spark%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/" title="Spark事件总线源码分析">Spark事件总线源码分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-03-08T11:54:07.000Z" title="发表于 2023-03-08 19:54:07">2023-03-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/bigdata/">bigdata</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/bigdata/spark/">spark</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/spark/">spark</a></span></div><div class="content">前言Spark中很多组件之间是靠事件消息实现通信的，之前分析了一下Spark中RPC机制，RPC和事件消息机制目的都是实现组件之间的通信，前者解决远程通信问题，而后者则是在本地较为高效的方式。Spark中大量采用事件监听这种方式，实现driver端的组件之间的通信。

ListenerBus1234567891011/** * An event bus which posts events to its listeners. */private[spark] trait ListenerBus[L &lt;: AnyRef, E] extends Logging &#123;  private[this] val listenersPlusTimers = new CopyOnWriteArrayList[(L, Option[Timer])]  // Marked `private[spark]` for access in tests.  private[spark] def listeners = listenersPlusTimers.asScala.map(_._1).asJ ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/02/bigdata/insight%20into%20Spark%20ESS/" title="理解Spark ESS"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://dogefs.s3.ladydaily.com/tzk/storage/000651627f0c-92aec253754ab3dba99f61b49e9aa856.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="理解Spark ESS"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/02/bigdata/insight%20into%20Spark%20ESS/" title="理解Spark ESS">理解Spark ESS</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-02-04T07:55:27.000Z" title="发表于 2023-02-04 15:55:27">2023-02-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Spark/">Spark</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/ESS/">ESS</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Spark/">Spark</a></span></div><div class="content">spark shuffle大概过程
spark shuffle分为两部分shuffle write和shuffle read。
在map write端，对每个task的数据，不管是按key hash还是在数据结构里先聚合再排序，最终都会将数据写到一个partitionFile里面，在partitionFile里面的数据是partitionId有序的，外加会生成一个索引文件，索引包含每个partition对应偏移量和长度。
而reduce read 端就是从这些partitionFile里面拉取相应partitionId的数据, 然后再进行聚合排序。
现在我们在来看下external shuffle service（ESS），其乍从其名字上看，ESS是spark分布式集群为存储shuffle data而设计的分布式组件。但其实它只是Spark通过Executor获取Shuffle data块的代理。
我们可以理解为ESS负责管理shuffle write端生成的shuffle数据，ESS是和yarn一起使用的， 在yarn集群上的每一个nodemanager上面都运行一个ESS，是一个常 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/01/bigdata/TroubleShooting/%E4%BF%AE%E5%A4%8DKylin4.0.x%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84push-down%20query/" title="修复Kylin4.0.x不正常的push-down query查询耗时"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://dogefs.s3.ladydaily.com/tzk/storage/20210302234030.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="修复Kylin4.0.x不正常的push-down query查询耗时"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/01/bigdata/TroubleShooting/%E4%BF%AE%E5%A4%8DKylin4.0.x%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84push-down%20query/" title="修复Kylin4.0.x不正常的push-down query查询耗时">修复Kylin4.0.x不正常的push-down query查询耗时</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-01-11T09:57:25.000Z" title="发表于 2023-01-11 17:57:25">2023-01-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Troubleshooting/">Troubleshooting</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Troubleshooting/Kylin/">Kylin</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Kylin/">Kylin</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Troubleshooting/">Troubleshooting</a></span></div><div class="content">问题描述
发现kylin4.0.x中的push-down query对于简单的明细查询select * from table limit 10非常慢，本来应该秒级响应，却往往耗时几分钟，并且查询的数据集越大，耗时越长,这非常不正常。BI工具往往会执行明细查询，进行数据展示，不正常的查询时长，往往造成BI工具超时，返回错误信息，这对用户体验非常不友好
通过排查发现，在这类非常简单的明细查询的查询计划中，竟然有shuffle过程，简直离谱。
线上定位问题代码当然离不开Arthas了，然后仔细阅读Kylin源码，找到问题代码所在！！！

修改源码
Kylin执行push-down query的主要逻辑集中在org.apache.kylin.query.pushdown.SparkSqlClient中，代码质量简直不忍直视，出现这个问题的主要原因就是代码质量太低。

在org.apache.kylin.query.pushdown.SparkSqlClient#DFToList中，不必要的Spark DataFrame类型转换transform是这个问题的主要原因。

修改后的代码如下org. ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2023/01/bigdata/superset/Apache%20Superset%E6%B7%BB%E5%8A%A0exclude%E5%87%BD%E6%95%B0/" title="Apache Superset添加EXCLUDE函数"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zfh-tuchuang.oss-cn-shanghai.aliyuncs.com/img/site-backgound.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Apache Superset添加EXCLUDE函数"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/01/bigdata/superset/Apache%20Superset%E6%B7%BB%E5%8A%A0exclude%E5%87%BD%E6%95%B0/" title="Apache Superset添加EXCLUDE函数">Apache Superset添加EXCLUDE函数</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-01-11T03:45:16.000Z" title="发表于 2023-01-11 11:45:16">2023-01-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Superset/">Superset</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Apache-Superset/">Apache Superset</a></span></div><div class="content">前言
因为业务需求，需要一个类似于Tableau中的exclude函数的功能。
例如：
若要查看一段时间内每个国家&#x2F;地区的平均血压，但不按男性和女性进行划分，请使用 EXCLUDE 详细级别表达式 &#123;EXCLUDE [Sex] : AVG[Average blood pressure]&#125;。
这个函数的功能对于业务来说非常重要，但是Apache Superset中没有此类功能，因此需要修改Apache Superset源码，为其添加上这个功能！这是一个不小的挑战！

新功能实现计划
1、获取由用户拖拽生成的BI图表的SQL语句。

2、拦截SQL语句进行改写，例如&#123;EXCLUDE [Sex] : AVG[blood-pressure]&#125;:

1、去除原SQL语句中的Sex维度信息和针对Sex的过滤条件，得到新的SQL
2、基于新的SQL发出对于blood-pressure度量来说是正确的聚合SQL，得到正确结果集
3、获取正确结果集中排除Sex维度后正确的blood-pressure度量聚合值。
4、利用正确的结果集中正确的部分，对原SQ ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/12/bigdata/TroubleShooting/%E4%BF%AE%E5%A4%8Dhudi%20metadata%20table%E4%B8%8EHDFS3.x%E4%B8%8D%E5%85%BC%E5%AE%B9%E7%9A%84%E9%97%AE%E9%A2%98/" title="修复hudi metadata table与HDFS3.x不兼容的问题"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://dogefs.s3.ladydaily.com/tzk/storage/000651627f0c-92aec253754ab3dba99f61b49e9aa856.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="修复hudi metadata table与HDFS3.x不兼容的问题"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/12/bigdata/TroubleShooting/%E4%BF%AE%E5%A4%8Dhudi%20metadata%20table%E4%B8%8EHDFS3.x%E4%B8%8D%E5%85%BC%E5%AE%B9%E7%9A%84%E9%97%AE%E9%A2%98/" title="修复hudi metadata table与HDFS3.x不兼容的问题">修复hudi metadata table与HDFS3.x不兼容的问题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-12-28T09:57:25.000Z" title="发表于 2022-12-28 17:57:25">2022-12-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Troubleshooting/">Troubleshooting</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Troubleshooting/">Troubleshooting</a></span></div><div class="content">
From 0.11.0 release, we have upgraded the HBase version to 2.4.9, which is released based on Hadoop 2.x. Hudi’s metadata table uses HFile as the base file format, relying on the HBase library. When enabling metadata table in a Hudi table on HDFS using Hadoop 3.x, NoSuchMethodError can be thrown due to compatibility issues between Hadoop 2.x and 3.x.

简述hudi的metadata table使用HFile作为基础文件格式，HFile依赖于HBase库。在Hudi0.12.1中使用HBase2.4.9版本，HBase2.4.9默认构建在Hadoop2.X，因此在HDFS3.x上使用Hudi metadata table会出现兼容性问题。抛 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/12/bigdata/TroubleShooting/Flink-hudi%E6%97%A5%E5%BF%97%E8%B6%85%E9%A2%91%E7%B9%81%E6%89%93%E5%8D%B0/" title="Flink-Hudi日志超频繁打印问题"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://dogefs.s3.ladydaily.com/tzk/storage/20210302234030.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Flink-Hudi日志超频繁打印问题"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/12/bigdata/TroubleShooting/Flink-hudi%E6%97%A5%E5%BF%97%E8%B6%85%E9%A2%91%E7%B9%81%E6%89%93%E5%8D%B0/" title="Flink-Hudi日志超频繁打印问题">Flink-Hudi日志超频繁打印问题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-12-04T09:57:25.000Z" title="发表于 2022-12-04 17:57:25">2022-12-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Troubleshooting/">Troubleshooting</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Flink/">Flink</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Troubleshooting/">Troubleshooting</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/Hudi/">Hudi</a></span></div><div class="content">问题描述将从Kafka读取CDC日志写入Hudi的Flink SQL作业部署到集群后，发现Flink Job Manager频繁打印以下日志，差不多1000次每秒，非常恐怖。Job Manager日志文件快速膨胀，占用大量磁盘空间，已经影响到集群稳定性。
12342022-12-04 09:24:40,897 INFO  org.apache.hadoop.hdfs.protocol.datatransfer.sasl.SaslDataTransferClient [] - SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false2022-12-04 09:24:40,899 INFO  org.apache.hadoop.hdfs.protocol.datatransfer.sasl.SaslDataTransferClient [] - SASL encryption trust check: localHostTrusted = false, remoteHostTrusted ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/11/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEBugFix%E5%90%88%E9%9B%86/" title="开源项目BugFix合集"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zfh-tuchuang.oss-cn-shanghai.aliyuncs.com/img/site-backgound.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="开源项目BugFix合集"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/11/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEBugFix%E5%90%88%E9%9B%86/" title="开源项目BugFix合集">开源项目BugFix合集</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-11-29T11:35:27.000Z" title="发表于 2022-11-29 19:35:27">2022-11-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/bigdata/">bigdata</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/bigdata/BugFix/">BugFix</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/BugFix/">BugFix</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/PR/">PR</a></span></div><div class="content">修复dolphinscheduler2.0.5中http-alert plugin丢失告警信息的Bug
http-alert告警插件仅仅发送用户预定义好的post body信息，丢失最重要Task运行告警信息。这是一个非常简单的Bug：https://github.com/apache/dolphinscheduler/commit/6021c228a1261a45ba8d02606f7132cd0a9b4c25

git clone dolphinscheduler项目，然后切到2.0.5-release分支，执行mvn -U clean package -Prelease -Dmaven.test.skip=true进行编译打包。打包成功后，将生成的dolphinscheduler\dolphinscheduler-alert\dolphinscheduler-alert-plugins\dolphinscheduler-alert-http\target\dolphinscheduler-alert-http-2.0.6-SNAPSHOT.jar替换掉原来的jar包。

启停 A ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/11/netty/Netty%E5%B0%8F%E8%AE%B0/" title="Netty与Reactor模型"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zfh-tuchuang.oss-cn-shanghai.aliyuncs.com/img/site-backgound.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty与Reactor模型"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/11/netty/Netty%E5%B0%8F%E8%AE%B0/" title="Netty与Reactor模型">Netty与Reactor模型</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-11-29T11:35:27.000Z" title="发表于 2022-11-29 19:35:27">2022-11-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Netty/">Netty</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Netty/">Netty</a></span></div><div class="content">
Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients.

基本概念：
1、Netty是对JDK NIO进行的一系列封装，使得更容易更快速的编写出高性能的安全的网络应用程序。

2、Java NIO与BIO一个重要的不同点是非阻塞，在Linux中，Java NIO依赖于Linux的epoll实现.

3、epoll是Linux中的专有名词或实现：epoll是一种I&#x2F;O事件通知机制，是linux 内核实现IO多路复用的一个实现。

Linu主要通过暴漏三个系统调用供上层应用使用epoll：int epoll_create(int size)、 int epoll_ctl(int epfd， int op， int fd， struct epoll_event *event)、int epoll_wait(int epfd， st ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/11/bigdata/%E9%85%8D%E7%BD%AEhadoop-snappy%E9%82%A3%E4%BA%9B%E4%BA%8B/" title="配置hadoop-snappy那些事"><img class="post_bg" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://dogefs.s3.ladydaily.com/tzk/storage/000651627f0c-92aec253754ab3dba99f61b49e9aa856.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="配置hadoop-snappy那些事"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/11/bigdata/%E9%85%8D%E7%BD%AEhadoop-snappy%E9%82%A3%E4%BA%9B%E4%BA%8B/" title="配置hadoop-snappy那些事">配置hadoop-snappy那些事</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-11-01T09:46:42.000Z" title="发表于 2022-11-01 17:46:42">2022-11-01</time></span></div><div class="content">前言在Apache Hadoop3.x社区二进制发行版中已经包含hadoop-snappy，同时Centos7已经自带snappy本地库。因此Hadoop3.x+Centos7无需配置snappy本地库。可运行hadoop checknative -a检查snappy本地库是否可用。

看了网上繁琐的Hadoop Snappy配置过程，配置了半天，才发现是白费功夫。原来是Hive的一个Bug。

Hive3.1.2中orc文件snappy压缩的BugBug描述
创建一个Hive表，存储为orc文件，同时启用snappy压缩。
12345678CREATE TABLE `default`.`user_orc` (  `tid` INT,  `userid` STRING)STORED AS orcTBLPROPERTIES (  &quot;orc.compress&quot;=&quot;SNAPPY&quot;);

Insert overwrite进一些数据
1insert overwrite table user_orc select * from user_1;

会在HDFS ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/#content-inner">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/#content-inner">6</a><a class="extend next" rel="next" href="/page/3/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/bg/avatar.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">破晓</div><div class="author-info__description">日拱一卒，功不唐捐</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">30</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Leopard" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:sssbbbb@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/SEO/" style="font-size: 1.15em; color: rgb(123, 154, 165)">SEO</a><a href="/tags/WSL/" style="font-size: 1.15em; color: rgb(154, 199, 165)">WSL</a><a href="/tags/Linxu/" style="font-size: 1.15em; color: rgb(94, 193, 179)">Linxu</a><a href="/tags/hexo/" style="font-size: 1.38em; color: rgb(77, 122, 95)">hexo</a><a href="/tags/CDN/" style="font-size: 1.15em; color: rgb(118, 171, 31)">CDN</a><a href="/tags/cloudflare/" style="font-size: 1.15em; color: rgb(42, 130, 55)">cloudflare</a><a href="/tags/github-pages/" style="font-size: 1.15em; color: rgb(80, 2, 140)">github pages</a><a href="/tags/CFW/" style="font-size: 1.15em; color: rgb(124, 84, 61)">CFW</a><a href="/tags/dns/" style="font-size: 1.15em; color: rgb(180, 134, 65)">dns</a><a href="/tags/BugFix/" style="font-size: 1.15em; color: rgb(149, 172, 102)">BugFix</a><a href="/tags/PR/" style="font-size: 1.15em; color: rgb(168, 108, 43)">PR</a><a href="/tags/Kylin/" style="font-size: 1.22em; color: rgb(114, 187, 149)">Kylin</a><a href="/tags/JVM/" style="font-size: 1.15em; color: rgb(32, 0, 182)">JVM</a><a href="/tags/MAT/" style="font-size: 1.15em; color: rgb(175, 84, 93)">MAT</a><a href="/tags/Arthas/" style="font-size: 1.15em; color: rgb(20, 139, 42)">Arthas</a><a href="/tags/Doris/" style="font-size: 1.45em; color: rgb(115, 187, 15)">Doris</a><a href="/tags/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0/" style="font-size: 1.15em; color: rgb(187, 17, 148)">数据中台</a><a href="/tags/Flink/" style="font-size: 1.38em; color: rgb(171, 132, 87)">Flink</a><a href="/tags/%E8%B0%83%E4%BC%98/" style="font-size: 1.15em; color: rgb(9, 198, 90)">调优</a><a href="/tags/HBase/" style="font-size: 1.15em; color: rgb(180, 109, 143)">HBase</a><a href="/tags/MVCC/" style="font-size: 1.15em; color: rgb(58, 168, 64)">MVCC</a><a href="/tags/Kyuubi/" style="font-size: 1.15em; color: rgb(37, 109, 21)">Kyuubi</a><a href="/tags/ESS/" style="font-size: 1.15em; color: rgb(147, 140, 103)">ESS</a><a href="/tags/Spark/" style="font-size: 1.15em; color: rgb(136, 198, 182)">Spark</a><a href="/tags/yarn/" style="font-size: 1.15em; color: rgb(119, 182, 100)">yarn</a><a href="/tags/hadoop/" style="font-size: 1.15em; color: rgb(8, 48, 146)">hadoop</a><a href="/tags/kudu/" style="font-size: 1.15em; color: rgb(51, 92, 1)">kudu</a><a href="/tags/%E7%94%A8%E6%88%B7%E7%94%BB%E5%83%8F/" style="font-size: 1.15em; color: rgb(96, 180, 149)">用户画像</a><a href="/tags/Netty/" style="font-size: 1.15em; color: rgb(105, 42, 15)">Netty</a><a href="/tags/LSM-Tree/" style="font-size: 1.15em; color: rgb(79, 116, 12)">LSM-Tree</a><a href="/tags/os/" style="font-size: 1.22em; color: rgb(161, 45, 91)">os</a><a href="/tags/Troubleshooting/" style="font-size: 1.3em; color: rgb(15, 153, 17)">Troubleshooting</a><a href="/tags/paimon/" style="font-size: 1.3em; color: rgb(91, 123, 77)">paimon</a><a href="/tags/thrift/" style="font-size: 1.15em; color: rgb(84, 156, 74)">thrift</a><a href="/tags/dolphinscheduler/" style="font-size: 1.15em; color: rgb(178, 133, 23)">dolphinscheduler</a><a href="/tags/spark/" style="font-size: 1.22em; color: rgb(9, 14, 171)">spark</a><a href="/tags/Druid/" style="font-size: 1.15em; color: rgb(160, 103, 183)">Druid</a><a href="/tags/Hudi/" style="font-size: 1.15em; color: rgb(19, 2, 30)">Hudi</a><a href="/tags/scala/" style="font-size: 1.15em; color: rgb(79, 20, 81)">scala</a><a href="/tags/LSM/" style="font-size: 1.15em; color: rgb(28, 190, 180)">LSM</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">五月 2023</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">十二月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><span class="card-archive-list-count">3</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">51</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2020-06-06T16:00:00.000Z"></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">74.3k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-06-27T14:21:14.731Z"></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 破晓</div><div class="footer_custom_text">VARIETY IS THE SPICE OF LIFE. POWERED BY HEXO WITH BUTTERFLY</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>function subtitleType () {
  getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js').then(() => {
    jinrishici.load(result =>{
      if (false) {
        const sub = ["今日事&#44;今日毕","Never put off till tomorrow what you can do today"]
        const content = result.data.content
        sub.unshift(content)
        window.typed = new Typed('#subtitle', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: false,
          backSpeed: 50,
        })
      } else {
        document.getElementById('subtitle').innerHTML = result.data.content
      }
    })
  })
}

if (false) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>